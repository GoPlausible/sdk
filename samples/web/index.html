<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connect samples</title>

    <script>
        function enableButtons() {
            const elements = document.getElementsByClassName('launch-button');
            for (let i = 0; i < elements.length; i++) {
                elements[i].disabled = false;
            }
        }

        function disableButtons(){
            const elements = document.getElementsByClassName('launch-button');
            for (let i = 0; i < elements.length; i++) {
                elements[i].disabled = true;
            }
        }

        async function createUrl() {
            disableButtons();
            const launchUrl = await fetch('/create-session', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(response => response.json()).then(r => r.launchUrl);
            window.launchUrl = launchUrl;
            enableButtons();
        }
        function exchangeResult(response) {
            console.log(response);
            fetch('/exchange-result', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({sessionId: response.sessionId, resultsAccessKey: response.resultsAccessKey})
            }).then(response => response.json()).then(r => document.getElementById('results').innerText = JSON.stringify(r, null, 2));
            //prepare for a next launch
            createUrl();
        }
        createUrl();
    </script>
</head>
<body style="background-color: gray 50%">
    <h1>Hi! Start a verification by clicking the buttons below. Make sure you're running one of the backend samples.</h1>
    <ul>
        <li>
            <button class="launch-button" disabled="true" onclick="launchIframe(window.launchUrl).then(r => exchangeResult(r))">Launch an iFrame</button>
        </li>
        <li>
            <button class="launch-button" disabled="true" onclick="launchRedirect(window.launchUrl, window.location.origin + '/redirect')">Launch redirect flow</button>
        </li>
        <li>
            <button class="launch-button" disabled="true" onclick="launchPopup(window.launchUrl).then(r => exchangeResult(r))">Launch popup</button>
        </li>
    </ul>    
    <pre id="results">

    </pre>

    <script type="module">
        // Import the function from your module
        import { launchIframe, launchRedirect, launchPopup } from '/dist/connect-web/index.js';

        // Assign the function to the global scope
        window.launchIframe = launchIframe;
        window.launchRedirect = launchRedirect;
        window.launchPopup = launchPopup;
    </script>
</body>
</html>